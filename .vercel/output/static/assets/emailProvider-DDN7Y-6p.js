const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-D6X-thcP.js","assets/react-vendor-Dq_i0H7_.js","assets/supabase-D2F8Vsqq.js","assets/index-Hq_XrwUb.css"])))=>i.map(i=>d[i]);
var e=Object.defineProperty,t=(t,s,r)=>((t,s,r)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r)(t,"symbol"!=typeof s?s+"":s,r);import{_ as s}from"./supabase-D2F8Vsqq.js";import"./react-vendor-Dq_i0H7_.js";class r{constructor(){t(this,"name","mock")}async send(e){return{success:!0,messageId:`mock-${Date.now()}`}}}function a(){return"mock".toLowerCase(),new r}function n(e,t){let s=e;return Object.keys(t).forEach(e=>{const r=t[e],a=new RegExp(`\\{\\{${e}\\}\\}`,"g");s=s.replace(a,String(r))}),s}function c(e){return e.replace(/<style[^>]*>.*?<\/style>/gi,"").replace(/<script[^>]*>.*?<\/script>/gi,"").replace(/<[^>]+>/g,"").replace(/&nbsp;/g," ").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/\n\s*\n\s*\n/g,"\n\n").trim()}async function o(e){const t=a();try{const{supabase:r}=await s(async()=>{const{supabase:e}=await import("./index-D6X-thcP.js").then(e=>e.a1);return{supabase:e}},__vite__mapDeps([0,1,2,3])),{data:a,error:o}=await r.from("email_templates").select("*").eq("slug",e.templateId).eq("status","active").single();if(o||!a)return{success:!1,error:"Email template not found"};const i=n(a.subject_en,e.variables),l=n(a.body_en,e.variables),u=await t.send({to:e.to,subject:i,html:l,text:c(l)});return await r.from("email_logs").insert({template_id:a.id,recipient_email:e.to,subject:i,body:l,status:u.success?"sent":"failed",sent_at:u.success?(new Date).toISOString():null,error_message:u.error}),u}catch(r){return{success:!1,error:r.message}}}export{a as createEmailProvider,c as htmlToPlainText,n as renderTemplate,o as sendEmail};
